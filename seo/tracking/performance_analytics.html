
<!-- Enhanced Performance Monitoring for A/B Testing -->
<script>
// Performance Metrics Collection
(function() {
    // Page Load Performance
    window.addEventListener('load', function() {
        setTimeout(function() {
            const perfData = performance.getEntriesByType('navigation')[0];
            const paintData = performance.getEntriesByType('paint');
            
            const metrics = {
                pageLoadTime: perfData.loadEventEnd - perfData.navigationStart,
                domContentLoaded: perfData.domContentLoadedEventEnd - perfData.navigationStart,
                firstPaint: paintData.find(entry => entry.name === 'first-paint')?.startTime || 0,
                firstContentfulPaint: paintData.find(entry => entry.name === 'first-contentful-paint')?.startTime || 0,
                timestamp: new Date().toISOString(),
                url: window.location.href,
                userAgent: navigator.userAgent,
                connectionType: navigator.connection?.effectiveType || 'unknown'
            };
            
            // Send to analytics
            if (typeof gtag !== 'undefined') {
                gtag('event', 'page_performance', {
                    custom_parameter_load_time: metrics.pageLoadTime,
                    custom_parameter_fcp: metrics.firstContentfulPaint,
                    custom_parameter_connection: metrics.connectionType
                });
            }
            
            // Log for debugging
            console.log('Performance Metrics:', metrics);
            
        }, 1000);
    });
    
    // Image Load Performance
    const images = document.querySelectorAll('img');
    images.forEach((img, index) => {
        const startTime = performance.now();
        
        img.addEventListener('load', function() {
            const loadTime = performance.now() - startTime;
            
            if (typeof gtag !== 'undefined') {
                gtag('event', 'image_performance', {
                    custom_parameter_load_time: loadTime,
                    custom_parameter_image_src: img.src,
                    custom_parameter_image_format: img.src.includes('.webp') ? 'webp' : 'other'
                });
            }
        });
    });
    
    // Interaction Tracking
    let engagementTime = 0;
    let startTime = performance.now();
    
    ['click', 'scroll', 'keydown'].forEach(event => {
        document.addEventListener(event, function() {
            engagementTime = performance.now() - startTime;
        });
    });
    
    // Send engagement data on page unload
    window.addEventListener('beforeunload', function() {
        if (typeof gtag !== 'undefined') {
            gtag('event', 'engagement_time', {
                custom_parameter_time: engagementTime,
                custom_parameter_url: window.location.href
            });
        }
    });
})();
</script>
        